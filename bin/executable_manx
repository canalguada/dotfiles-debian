#!/bin/sh
# vim: set ft=sh fdm=indent ai ts=2 sw=2 tw=79 noet:

args="$*"
available=

if [ -z "$*" ]; then
	set -- $(ps -q $PPID aho comm)
fi

while [ -n "$*" ]; do
	/usr/bin/man -f "$1" >/dev/null 2>&1 && available="$available $1"
	shift
done

if [ -z "$available" ]; then
  echo "$args : rien d'adÃ©quat"
  exit 2
fi

cmd="/usr/bin/man -a -L C "
tabbed=n

if xset q >/dev/null 2>&1; then
	tabbed=y
elif [ $(LANG=C tty) = "not a tty" ]; then
	echo "Session graphique ou terminal requis."
	exit 1
fi

## From custom.zsh support colors in less
# export LESS_TERMCAP_mb=$'\E[01;31m'
# export LESS_TERMCAP_md=$'\E[01;31m'
# export LESS_TERMCAP_me=$'\E[0m'
# export LESS_TERMCAP_se=$'\E[0m'
# export LESS_TERMCAP_so=$'\E[01;44;33m'
# export LESS_TERMCAP_ue=$'\E[0m'
# export LESS_TERMCAP_us=$'\E[01;32m'

mkdir -p /tmp/$USER

# shellcheck disable=SC2086
for item in $available; do
	tmpscript=$(mktemp -p /tmp/$USER)
	cat <<-_EOF_ >"$tmpscript"
	#!/usr/bin/zsh
	export LESS_TERMCAP_mb=$'\E[01;31m'
	export LESS_TERMCAP_md=$'\E[01;31m'
	export LESS_TERMCAP_me=$'\E[0m'
	export LESS_TERMCAP_se=$'\E[0m'
	export LESS_TERMCAP_so=$'\E[01;44;33m'
	export LESS_TERMCAP_ue=$'\E[0m'
	export LESS_TERMCAP_us=$'\E[01;32m'
	$cmd $item
	rm $tmpscript
	_EOF_
	chmod +x $tmpscript

	if [ "$tabbed" = "y" ]; then
		urxvtc -title "$cmd $item" -e $tmpscript
	else
		$tmpscript
	fi
done

